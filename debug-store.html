<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Store</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .log { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .info { background: #e3f2fd; border-left: 4px solid #2196f3; }
    </style>
</head>
<body>
    <h1>üîç Debug Dashboard Store</h1>
    <div id="logs"></div>

    <script type="module">
        function log(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            document.getElementById('logs').appendChild(logDiv);
            console.log(message);
        }

        async function testStore() {
            try {
                log('üöÄ Iniciando teste do store...', 'info');

                // Teste 1: Testar conex√£o com API
                log('üì° Testando conex√£o com API...', 'info');
                const response = await fetch('http://localhost:3000/api/sugestoes');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`‚úÖ API respondeu com ${data.sugestoes?.length || 0} sugest√µes`, 'success');

                // Teste 2: Processar dados como o store faria
                log('üîÑ Processando dados...', 'info');

                if (data.sugestoes && data.sugestoes.length > 0) {
                    const processedItems = data.sugestoes.map(sugestao => {
                        // Fun√ß√µes auxiliares inline (iguais ao store)
                        const getSuggestionTitle = (texto, tipo) => {
                            const typeIcons = {
                                geral: 'üí°',
                                dashboard: 'üìä',
                                ranking: 'üèÜ',
                                auditoria: 'üîç',
                                relatorios: 'üìã'
                            };
                            const icon = typeIcons[tipo] || 'üìù';
                            const lines = texto.split('\\n\\n');
                            const title = lines[0] || texto.substring(0, 50);
                            return `${icon} ${title}`;
                        };

                        const getSuggestionDescription = (texto) => {
                            const lines = texto.split('\\n\\n');
                            if (lines.length > 1) {
                                return lines.slice(1).join('\\n\\n');
                            }
                            return texto.length > 100 ? texto.substring(0, 100) + '...' : texto;
                        };

                        return {
                            id: sugestao.id || sugestao._id,
                            type: sugestao.tipo,
                            title: getSuggestionTitle(sugestao.sugestao, sugestao.tipo),
                            description: getSuggestionDescription(sugestao.sugestao),
                            votes: sugestao.votos || 0,
                            time: sugestao.tempoDecorrido || 'Hoje',
                            originalSuggestion: sugestao.sugestao
                        };
                    });

                    log(`‚úÖ Processados ${processedItems.length} itens do feed`, 'success');

                    // Mostrar alguns exemplos
                    processedItems.slice(0, 3).forEach((item, index) => {
                        log(`üìù Post ${index + 1}: "${item.title}" - ${item.description.substring(0, 50)}...`, 'info');
                    });

                } else {
                    log('‚ö†Ô∏è Nenhuma sugest√£o encontrada', 'error');
                }

            } catch (error) {
                log(`‚ùå Erro no teste: ${error.message}`, 'error');
                log(`üîç Stack trace: ${error.stack}`, 'error');
            }
        }

        // Executar teste
        testStore();
    </script>
</body>
</html>